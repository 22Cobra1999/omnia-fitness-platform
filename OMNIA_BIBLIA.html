<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Biblia Omnia</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }

    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }

    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }

    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }

      p,
      h2,
      h3 {
        orphans: 3;
        widows: 3;
      }

      h2,
      h3,
      h4 {
        page-break-after: avoid;
      }
    }

    p {
      margin: 1em 0;
    }

    a {
      color: #1a1a1a;
    }

    a:visited {
      color: #1a1a1a;
    }

    img {
      max-width: 100%;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin-top: 1.4em;
    }

    h5,
    h6 {
      font-size: 1em;
      font-style: italic;
    }

    h6 {
      font-weight: normal;
    }

    ol,
    ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }

    li>ol,
    li>ul {
      margin-top: 0;
    }

    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }

    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }

    pre {
      margin: 1em 0;
      overflow: auto;
    }

    pre code {
      padding: 0;
      overflow: visible;
    }

    .sourceCode {
      background-color: transparent;
      overflow: visible;
    }

    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }

    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }

    table caption {
      margin-bottom: 0.75em;
    }

    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }

    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }

    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }

    header {
      margin-bottom: 4em;
      text-align: center;
    }

    #TOC li {
      list-style: none;
    }

    #TOC a:not(:hover) {
      text-decoration: none;
    }

    code {
      white-space: pre-wrap;
    }

    span.smallcaps {
      font-variant: small-caps;
    }

    span.underline {
      text-decoration: underline;
    }

    div.column {
      display: inline-block;
      vertical-align: top;
      width: 50%;
    }

    div.hanging-indent {
      margin-left: 1.5em;
      text-indent: -1.5em;
    }

    ul.task-list {
      list-style: none;
    }

    .display.math {
      display: block;
      text-align: center;
      margin: 0.5rem auto;
    }

    /* Visual Logic Map Styles */
    .logic-container {
      background: #0a0b0d;
      color: #e0e0e0;
      padding: 25px;
      border-radius: 16px;
      font-family: 'Menlo', 'Monaco', monospace;
      font-size: 13px;
      margin: 2em 0;
      border: 1px solid #1f2023;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .logic-title {
      color: #FF7939;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }

    .logic-layer {
      margin-bottom: 15px;
      padding-left: 15px;
      border-left: 2px solid #444;
    }

    .layer-label {
      font-size: 10px;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 5px;
      display: block;
    }

    .node {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      margin: 4px 0;
    }

    .ux-node {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid #444;
    }

    .hook-node {
      background: rgba(0, 150, 255, 0.1);
      border: 1px solid #0077ff;
      color: #4faaff;
    }

    .api-node {
      background: rgba(255, 165, 0, 0.1);
      border: 1px solid #ffae00;
      color: #ffae00;
    }

    .state-node {
      background: rgba(76, 175, 80, 0.1);
      border: 1px solid #4caf50;
      color: #81c784;
    }

    .arrow {
      color: #555;
      margin: 0 5px;
    }

    .branch {
      padding-left: 20px;
      border-left: 1px dashed #333;
      margin-top: 5px;
    }

    /* Tree Design Styles */
    .tree-container {
      background: #0d1117;
      color: #c9d1d9;
      padding: 40px;
      border-radius: 12px;
      font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
      font-size: 13px;
      line-height: 2;
      border: 1px solid #30363d;
      margin: 20px 0;
      box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.8);
      position: relative;
    }

    .tree-title {
      color: #58a6ff;
      font-weight: bold;
      font-size: 20px;
      border-bottom: 2px solid #1f6feb;
      margin-bottom: 30px;
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .tree-division {
      color: #ff7b72;
      font-weight: bold;
      font-size: 16px;
      margin-top: 30px;
      display: block;
      padding: 5px 10px;
      background: rgba(255, 123, 114, 0.1);
      border-radius: 4px;
      width: fit-content;
    }

    .tree-branch {
      position: relative;
      margin-left: 20px;
      border-left: 1px solid #30363d;
      padding-left: 20px;
    }

    .tree-tab {
      color: #d2a8ff;
      display: block;
      position: relative;
      font-weight: bold;
    }

    .tree-tab:before {
      content: "";
      position: absolute;
      left: -20px;
      top: 15px;
      width: 15px;
      border-top: 1px solid #30363d;
    }

    .tree-action {
      color: #79c0ff;
      margin-left: 20px;
      display: block;
      position: relative;
    }

    .tree-action:before {
      content: "";
      position: absolute;
      left: -20px;
      top: 15px;
      width: 15px;
      border-top: 1px solid #30363d;
    }

    .tree-detail {
      margin-left: 40px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #8b949e;
      position: relative;
    }

    .tree-detail:before {
      content: "";
      position: absolute;
      left: -20px;
      top: 15px;
      width: 15px;
      border-top: 1px solid #30363d;
    }

    .status-pill {
      font-size: 9px;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .pill-green {
      background: #238636;
      color: #fff;
      box-shadow: 0 0 10px rgba(35, 134, 54, 0.3);
    }

    .pill-yellow {
      background: #9e6a03;
      color: #fff;
      box-shadow: 0 0 10px rgba(158, 106, 3, 0.3);
    }

    .pill-red {
      background: #da3633;
      color: #fff;
      box-shadow: 0 0 10px rgba(218, 54, 51, 0.3);
    }

    .pill-blue {
      background: #1f6feb;
      color: #fff;
      box-shadow: 0 0 10px rgba(31, 111, 235, 0.3);
    }

    .line-count {
      color: #484f58;
      font-size: 11px;
      background: #161b22;
      padding: 0 6px;
      border-radius: 3px;
    }

    code {
      background: none !important;
      color: #c9d1d9 !important;
    }
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>

<body>
  <header id="title-block-header">
    <h1 class="title">Biblia Omnia</h1>
  </header>
  <h1 id="omnia-la-biblia-completa-del-sistema">üìñ OMNIA: La Biblia Completa del Sistema</h1>
  <p>Bienvenido al repositorio central de conocimiento t√©cnico de Omnia. Este documento consolida todos los flujos de
    datos, consultas cr√≠ticas y procesos de carga tanto para el Cliente como para el Coach.</p>
  <hr />

  <h2 id="sala-de-trofeos">üèÜ Sala de Trofeos (Monsters Hunted)</h2>
  <div class="logic-container" style="background: #0f1218; border: 1px solid #30363d;">
    <div class="logic-title" style="color: #e3b341; border-color: #e3b341;">üíÄ MONSTRUOS ABATIDOS</div>

    <div class="logic-layer">
      <span class="layer-label">EL LEVIAT√ÅN (ORIGINAL)</span>
      <div class="node" style="background: #da3633; color: white;">TodayScreen_OLD.tsx (ELIMINADO üóëÔ∏è)</div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è REFACTORIZADO EN</span>
        <div class="node pill-blue">Modules: Header, ActivityList, Hooks (~236 l√≠neas core)</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">EL LABERINTO DE PRODUCTOS</span>
      <div class="node" style="background: #da3633; color: white;">products-management-screen_OLD.tsx (ELIMINADO üóëÔ∏è)
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è DOMADO EN</span>
        <div class="node pill-blue">Index (~89 l√≠neas) + Logic Hooks (~570 l√≠neas)</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">EL PLANIFICADOR DEL CAOS</span>
      <div class="node" style="background: #9e6a03; color: white;">DayExercisesModal.tsx (Complejidad L√≥gica
        Exponencial)</div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è OPTIMIZADO EN</span>
        <div class="node pill-green">~430 l√≠neas (Datos Blindados + UI Premium)</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">LA DUPLICADORA DE MEETS</span>
      <div class="node" style="background: #da3633; color: white;">CalendarView.tsx (Bug Cr√≠tico: Duplicaci√≥n de Meets)
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è CAZADO Y ELIMINADO</span>
        <div class="node pill-green">Flujo de Reschedule Unificado + Modal de Confirmaci√≥n Premium</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">EL COLOSO DEL COACH</span>
      <div class="node" style="background: #da3633; color: white;">CoachCalendarScreen.tsx (3,142 l√≠neas de CAOS)</div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è FRAGMENTADO Y DOMADO</span>
        <div class="node pill-blue">Modularizado en 5 Hooks + 4 Vistas Especializadas (~280 l√≠neas core)</div>
      </div>
    </div>
  </div>
  <hr />
  <h2 id="√≠ndice-de-navegaci√≥n">üìë √çndice de Navegaci√≥n</h2>
  <h3 id="aplicaci√≥n-del-cliente-client-app">üë§ Aplicaci√≥n del Cliente (Client App)</h3>
  <ol type="1">
    <li><a href="#explorar-marketplace"><strong>Explorar / Marketplace</strong></a>: Descubrimiento y compra de
      productos.</li>
    <li><a href="#mis-actividades"><strong>Mis Actividades</strong></a>: Seguimiento de progreso y consumo.</li>
    <li><a href="#calendario-cliente"><strong>Calendario del Cliente</strong></a>: Gesti√≥n de turnos y eMeets.</li>
    <li><a href="#perfil-cliente"><strong>Perfil del Cliente</strong></a>: Datos personales, biometr√≠a y metas.</li>
    <li><a href="#comunidad-cliente"><strong>Comunidad</strong></a>: Feed social e interacciones.</li>
    <li><a href="#mensajeria-cliente"><strong>Mensajer√≠a</strong></a>: Chat directo con coaches.</li>
  </ol>
  <h3 id="panel-del-coach-coach-dashboard">üë®‚Äçüè´ Panel del Coach (Coach Dashboard)</h3>
  <ol start="7" type="1">
    <li><a href="#gestion-clientes-coach"><strong>Gesti√≥n de Clientes</strong></a>: Cartera y detalle de evoluci√≥n.</li>
    <li><a href="#gestion-productos-coach"><strong>Gesti√≥n de Productos</strong></a>: Creaci√≥n de ejercicios y
      nutrici√≥n.</li>
    <li><a href="#calendario-coach"><strong>Calendario del Coach</strong></a>: Disponibilidad y sincronizaci√≥n eMeet.
    </li>
    <li><a href="#gestion-video-coach"><strong>Gesti√≥n de Videos (Bunny.net)</strong></a>: Subida y streaming.</li>
    <li><a href="#gestion-documentos-coach"><strong>Gesti√≥n de Documentos</strong></a>: Estructura de PDFs y temas.</li>
    <li><a href="#perfil-coach"><strong>Perfil del Coach</strong></a>: Configuraci√≥n y marca personal.</li>
  </ol>
  <h3 id="l√≥gica-y-arquitectura-t√©cnica">üß† L√≥gica y Arquitectura T√©cnica</h3>
  <ol start="13" type="1">
    <li><a href="#onboarding-logic"><strong>Formulario de Onboarding</strong></a>: L√≥gica de admisi√≥n.</li>
    <li><a href="#progreso-logic"><strong>Generaci√≥n de Progreso</strong></a>: El ‚ÄúMotor de Instanciaci√≥n‚Äù.</li>
    <li><a href="#script-audit"><strong>Auditor√≠a de Scripts y QA</strong></a>: Dashboard de eficiencia y deuda t√©cnica.
    </li>
    <li><a href="#logic-map"><strong>Mapa de Salud Operativa y Estructura</strong></a>: Arquitectura Visual de Omnia.
    </li>
  </ol>
  <p><a name="explorar-marketplace"></a> ## 1. üîç Explorar / Marketplace (Client)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Descubrimiento y Conversi√≥n</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Client: Scroll Marketplace ‚Üí Search "Running" ‚Üí Click ActivityCard</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">search-screen.tsx: handleSearchChange() ‚Üí filterActivities()</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node hook-node">handleActivityClick() ‚Üí setNavigationStack()</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">GET /api/activities/search?q=running</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">View: activities_with_coaches (Pre-mapped)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: isPreviewModalOpen = true ‚Üí [ClientProductModal]</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> La b√∫squeda local `filterActivities` es r√°pida pero puede
    desincronizarse si el coach cambia el precio mientras el cliente navega. <em>Optimizaci√≥n:</em> Implementar
    validaci√≥n de precio final en el √∫ltimo step del checkout.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="mis-actividades"></a> ## 2. üèÉ Mis Actividades (Client)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Consumo de Producto</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Client: Click en "Actividades" Tab ‚Üí Selecciona "En curso"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">TodayScreen: useTodayScreenLogic() ‚Üí filterByStatus("in_progress")</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">RPC: get_user_enrolled_activities(user_id)</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: enrolledActivitiesList ‚Üí Render ActivityCard con % progreso</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> El c√°lculo de `% progreso` ocurre on-the-fly. <em>Optimizaci√≥n:</em>
    Persistir el % en `activity_enrollments` cada vez que se marca un item como completado para evitar recalculadas
    costosas.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="calendario-cliente"></a> ## 3. üìÖ Calendario del Cliente (Client)</p>

  <div class="logic-container">
    <div class="logic-title">üåÄ Flujo Completo de Meets: Creaci√≥n, Modificaci√≥n y Cancelaci√≥n</div>

    <div class="logic-layer">
      <span class="layer-label">üìå ESCENARIO 1: Crear Nueva Meet</span>
      <div class="node ux-node">Client: Selecciona coach ‚Üí Elige fecha/hora ‚Üí Click "Confirmar Reserva"</div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è</span>
        <div class="node api-node">INSERT calendar_events { title, start_time, end_time, coach_id, client_id, status:
          'scheduled' }</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è</span>
        <div class="node api-node">INSERT calendar_event_participants { event_id, client_id, rsvp_status: 'pending',
          invited_by_user_id: client_id }</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è</span>
        <div class="node state-node">UI: Modal de √©xito ‚Üí Calendario actualizado</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">üìå ESCENARIO 2: Modificar Meet Pendiente (Cliente Creador)</span>
      <div class="node ux-node">Client: Click en meet ‚Üí "Modificar horario" ‚Üí Selecciona nuevo slot ‚Üí "Confirmar"</div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è VERIFICACI√ìN</span>
        <div class="node hook-node">rescheduleContext detectado ‚Üí Fetch participant data</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è CONDICI√ìN</span>
        <div class="node api-node">IF (rsvp_status === 'pending' && invited_by_user_id === client_id)</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è ACCI√ìN</span>
        <div class="node api-node" style="background: #2ea043; color: white;">UPDATE calendar_events SET start_time,
          end_time WHERE id = event_id</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è</span>
        <div class="node state-node">‚úÖ Meet actualizada (NO duplicada) ‚Üí Modal de √©xito</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">üìå ESCENARIO 3: Modificar Meet Confirmada</span>
      <div class="node ux-node">Client: Click en meet confirmada ‚Üí "Reprogramar" ‚Üí Selecciona nuevo slot</div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è VERIFICACI√ìN</span>
        <div class="node hook-node">rescheduleContext detectado ‚Üí Fetch participant data</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è CONDICI√ìN</span>
        <div class="node api-node">IF (rsvp_status === 'confirmed' || 'accepted')</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è ACCI√ìN</span>
        <div class="node state-node">UI: Modal de preview de reschedule ‚Üí Requiere confirmaci√≥n del coach</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">üìå ESCENARIO 4: Cancelar Meet</span>
      <div class="node ux-node">Client: Click en meet ‚Üí "Cancelar solicitud" / "Cancelar mi asistencia"</div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è</span>
        <div class="node state-node" style="background: #1f2937; color: white;">UI: Modal de confirmaci√≥n personalizado
          (glassmorphism)</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è SI CONFIRMA</span>
        <div class="node api-node">UPDATE calendar_events SET status = 'cancelled' WHERE id = event_id</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è</span>
        <div class="node api-node">UPDATE calendar_event_participants SET rsvp_status = 'cancelled'</div>
      </div>
      <div class="branch">
        <span class="arrow">‚¨áÔ∏è</span>
        <div class="node state-node">Toast: "Asistencia cancelada" ‚Üí Calendario actualizado</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">üîß COMPONENTES CLAVE</span>
      <div class="node hook-node">CalendarView.tsx: handleTimelineClick(), confirmaci√≥n en modal y day_split</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node hook-node">MeetDetailModal.tsx: handleSuggestNewTime(), handleCancel(), confirmCancel()</div>
      </div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node state-node">rescheduleContext: { eventId, originalTitle, originalDescription }</div>
      </div>
    </div>
  </div>

  <p><strong>üêõ Bug Cr√≠tico Resuelto:</strong> Duplicaci√≥n de meets al modificar horario. El sistema ahora verifica el
    estado del meet (pending vs confirmed) y el rol del usuario (creador vs invitado) para decidir si actualizar el
    evento existente o crear una solicitud de reschedule.</p>
  <p><strong>üé® UX Premium:</strong> Modal de confirmaci√≥n personalizado con glassmorphism reemplaza el window.confirm
    nativo del navegador.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="perfil-cliente"></a> ## 4. üë§ Perfil del Cliente (Client)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Actualizaci√≥n Biom√©trica</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Client: Abre biometrics-modal ‚Üí Ingresa "Peso: 85kg" ‚Üí Save</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">biometrics-modal.tsx: handleSave() ‚Üí supabase.upsert()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">Table: user_biometrics (New Row with timestamp)</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">DB Table: clients (Update current_weight)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: userStats ‚Üí re-render Rings de Actividad</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> No hay validaci√≥n de rangos extremos (ej. peso 1000kg).
    <em>Optimizaci√≥n:</em> Agregar validaci√≥n de Z-score para alertar al usuario sobre errores de entrada.
  </p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="comunidad-cliente"></a> ## 5. ü§ù Comunidad (Client)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Feed Social</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Client: Escribe Post ‚Üí Click "Publicar"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">community-screen.tsx: handleCreatePost()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">INSERT table: community_posts { user_id, content, media }</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: postsFeed (Unshift new post) ‚Üí UI: Feed Update</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> Inyecci√≥n de scripts en el content. <em>Optimizaci√≥n:</em> Sanitizar el
    HTML/Markdown en el cliente y doble check en el DB Trigger.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="mensajeria-cliente"></a> ## 6. üí¨ Mensajer√≠a (Client)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Chat Real-Time</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Client: Escribe mensaje ‚Üí Send</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">messages-screen.tsx: handleSendMessage() ‚Üí Supabase Subscription</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">INSERT table: messages { chat_id, content }</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">Broadcast: REALTIME payload to recipient</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: activeChatMessages (Push new msg)</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> Flooding de mensajes. <em>Optimizaci√≥n:</em> Implementado l√≠mite diario
    de 10 mensajes por chat por usuario. Bloqueo hasta 00:00hs.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="gestion-clientes-coach"></a> ## 7. üë• Gesti√≥n de Clientes (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Auditor√≠a de Evoluci√≥n</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Coach: Click en Cliente "Franco" ‚Üí Tab "Progreso"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">clients-screen.tsx: loadClientDetailedData()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">View: client_evolution_chart (Aggregation of 30 days)</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: selectedClientStats ‚Üí Recharts: LineGraph</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> Acceso a clientes de otro coach via URL. <em>Optimizaci√≥n:</em> RLS
    (Row Level Security) estricto en Supabase verificado: `coach_id = auth.uid()`.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="gestion-productos-coach"></a> ## 8. üõí Gesti√≥n de Productos (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Gesti√≥n de Inventario Comercial</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Coach: Toggle "Caf√© de Consulta" ‚Üí Change Price</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">useConsultationLogic.ts: updatePrice() ‚Üí Optimistic UI Update</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">PATCH /api/coach/consultation { price, enabled }</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">UPDATE table: coaches (Atomic field update)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: consultationData (Synced)</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> Precios negativos o absurdos. <em>Optimizaci√≥n:</em> Implementar
    validaci√≥n de Schema (Zod) en el endpoint para asegurar que el precio est√© entre $500 y $500.000.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="calendario-coach"></a> ## 9. üìÖ Calendario del Coach (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Sincronizaci√≥n eMeet</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Coach: Abre Calendario ‚Üí Click "Sincronizar Disponibilidad"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">coach-calendar-screen.tsx: syncWithGoogle()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">API /api/google-calendar/auth ‚Üí Sync Access Token</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">Worker: Sync external events into activity_sessions</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: agendaItems (Merged Local + Google)</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> Expiraci√≥n de tokens de Google. <em>Optimizaci√≥n:</em> Implementar un
    Refresh Token autom√°tico en el worker de sincronizaci√≥n para evitar que el calendario se quede "congelado".</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="gestion-video-coach"></a> ## 10. üé• Gesti√≥n de Videos (Bunny.net) e Im√°genes (Supabase)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Subida de Media en Wizard de Producto</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Coach: Selecciona Archivo en Wizard</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Decision Branch: Image vs Video</span>
      <div class="branch">
        <span class="arrow">‚îú‚îÄ‚îÄ</span>
        <div class="node hook-node">IMAGEN: Subida Inmediata (Supabase)</div>
        <div class="node api-node">POST /api/upload-organized ‚Üí Retorna URL p√∫blica</div>
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node hook-node">VIDEO: Subida Diferida (Bunny.net)</div>
        <div class="node state-node">state: pendingVideoFile (Preview local con URL.createObjectURL)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Final Trigger: Guardar/Publicar Producto</span>
      <div class="node ux-node">Coach: Click "Guardar" o "Publicar"</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">Si hay pendingVideoFile ‚Üí POST /api/bunny/upload-video (Stream)</div>
        <div class="node api-node">POST /api/products (Guarda URL de imagen ya subida + URL de video reci√©n subido)
        </div>
      </div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Regla de Oro:</strong> Las im√°genes de portada se suben <em>inmediatamente</em> al seleccionarlas para
    feedback visual r√°pido y persistencia simple. Los videos, al ser pesados y costosos (Bunny), se mantienen en memoria
    (Blob local) y <em>solo</em> se suben cuando el usuario confirma la creaci√≥n/edici√≥n del producto.
  </p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="gestion-documentos-coach"></a> ## 11. üìÑ Gesti√≥n de Documentos (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Librer√≠a de Conocimiento</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Coach: Upload PDF ‚Üí Asigna "Tema: Nutrici√≤n Pro"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">document-manager.tsx: handleDocUpload()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">Supabase Storage: /pdfs/coaches/{id}/*</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">INSERT table: document_topics { pdf_url, activity_id }</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: activityDocs (Ready for client download)</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> PDFs con scripts maliciosos. <em>Optimizaci√≥n:</em> Implementar escaneo
    de virus en el bucket de Supabase o forzar la visualizaci√≥n en un Sandboxed PDF Viewer.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="perfil-coach"></a> ## 12. üë§ Perfil del Coach (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Marca Personal</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Coach: Edita Bio ‚Üí Agrega Especialidad "Crossfit" ‚Üí Save</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">coach-profile-screen.tsx: handleUpdateProfile()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">UPDATE table: user_profiles { bio, specialties }</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: coachMasterProfile (Synced) ‚Üí UI: "Perfil actualizado"</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> Suplantaci√≥n de identidad si se permite cambiar correos verificados.
    <em>Optimizaci√≥n:</em> Bloquear el cambio de Email una vez la cuenta es de tipo "Coach" y requerir ticket de soporte
    para modificaciones legales.
  </p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="onboarding-logic"></a> ## 13. üß† Formulario de Onboarding (L√≥gica)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: Perfilado del Cliente</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">Client: Completa Step 7 ‚Üí Click "Listo, Empezar"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Hooks</span>
      <div class="node hook-node">onboarding-modal.tsx: handleSubmit()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">UPSERT: client_onboarding_responses (Answers mapping)</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">UPDATE: clients (Fisical data parsing)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: userOnboarded = true ‚Üí (Close Modal)</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> Desconexi√≥n durante el env√≠o de 7 pasos. <em>Optimizaci√≥n:</em>
    Implementar guardado parcial ("Draft") en cada step para que el usuario pueda retomar si se queda sin bater√≠a o
    se√±al.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="progreso-logic"></a> ## 14. ‚öôÔ∏è Generaci√≥n de Progreso (Technical)</p>
  <div class="logic-container">
    <div class="logic-title">üåÄ Workflow: El Motor de Instanciaci√≥n</div>
    <div class="logic-layer">
      <span class="layer-label">UX ‚Üí Trigger</span>
      <div class="node ux-node">System: Detection of "Purchase Completed"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic ‚Üí Trigger</span>
      <div class="node hook-node">client-product-modal.tsx: handlePurchase() ‚Üí activation_trigger</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic ‚Üí API/DB</span>
      <div class="node api-node">API /api/initialize-progress (The Oracle)</div>
      <div class="branch">
        <span class="arrow">‚îî‚îÄ‚îÄ</span>
        <div class="node api-node">Fetch definition (planificacion_ejercicios)</div>
        <div class="branch">
          <span class="arrow">‚îî‚îÄ‚îÄ</span>
          <div class="node api-node">Apply Onboarding Filters (Conditionals: injuries/level)</div>
          <span class="arrow">‚îî‚îÄ‚îÄ</span>
          <div class="node api-node">INSERT: progreso_cliente (The massive persistent list)</div>
        </div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State ‚Üí UI</span>
      <div class="node state-node">state: progression_initialized = true</div>
    </div>
  </div>
  <p><strong>‚ö†Ô∏è Scan de Vulnerabilidad:</strong> Tiempo de ejecuci√≥n excesivo en programas de +6 meses.
    <em>Optimizaci√≥n:</em> Ejecutar el motor en un **Background Queue** y notificar al cliente v√≠a Push/Email cuando su
    plan est√© listo.
  </p>
  <hr />
  <p><a name="script-audit"></a> ## 15. üß™ Auditor√≠a de Scripts y Eficiencia (QA Dashboard) An√°lisis de los archivos
    cr√≠ticos del sistema para evaluaci√≥n de rendimiento, deuda t√©cnica y estabilidad.</p>
  <table>
    <colgroup>
      <col style="width: 14%" />
      <col style="width: 17%" />
      <col style="width: 17%" />
      <col style="width: 17%" />
      <col style="width: 17%" />
      <col style="width: 14%" />
    </colgroup>
    <thead>
      <tr class="header">
        <th style="text-align: left;">Script / Componente</th>
        <th style="text-align: center;">L√≠neas</th>
        <th style="text-align: center;">Importancia</th>
        <th style="text-align: center;">Redundancia</th>
        <th style="text-align: center;">Calificaci√≥n QA</th>
        <th style="text-align: left;">Observaciones del QA Tester</th>
      </tr>
    </thead>
    <tbody>
      <tr class="odd">
        <td style="text-align: left;"><code>ProductsManagement (Refactored)</code></td>
        <td style="text-align: center;">~1000</td>
        <td style="text-align: center;">CR√çTICA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 10/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> L√≥gica separada de la UI. Altamente mantenible y
          performante en mobile.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>useCreateProductLogic.ts (Refactored)</code></td>
        <td style="text-align: center;">~570</td>
        <td style="text-align: center;">CR√çTICA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>DOMADO.</strong> L√≥gica de Wizard extra√≠da y modularizada en 6 sub-hooks
          especializados.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>csv-manager-enhanced.tsx</code></td>
        <td style="text-align: center;">1035</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 10/10</td>
        <td style="text-align: left;"><strong>DOMADO EXTREMO.</strong> L√≥gica totalmente extra√≠da a hooks especializados
          (useCsvActions, useCsvFileProcessor). UI limpia y modular.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>weekly-exercise-planner.tsx</code></td>
        <td style="text-align: center;">326</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;">F√âNIX. Refactorizado masivamente. La l√≥gica compleja migr√≥ a
          DayExercisesModal.tsx.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>CalendarView.tsx</code></td>
        <td style="text-align: center;">~3900</td>
        <td style="text-align: center;">CR√çTICA</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">üü¢ 8/10</td>
        <td style="text-align: left;"><strong>BUG FIX CR√çTICO.</strong> Eliminada duplicaci√≥n de meets en reschedule.
          Flujo unificado para pending meets: actualiza evento existente en lugar de crear duplicado. L√≥gica aplicada en
          modal y vista day_split.
        </td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>MeetDetailModal.tsx</code></td>
        <td style="text-align: center;">666</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>UX PREMIUM.</strong> Reemplazado window.confirm nativo por modal
          personalizado con glassmorphism. Confirmaci√≥n de cancelaci√≥n con estilo OMNIA.
        </td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>coach-calendar-screen.tsx</code></td>
        <td style="text-align: center;">3141</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">üü¢ 7/10</td>
        <td style="text-align: left;">Manejo de estados de eMeet funcional pero complejo.</td>
      </tr>

      <tr class="even">
        <td style="text-align: left;"><s>products-management-screen_OLD.tsx</s></td>
        <td style="text-align: center;">0</td>
        <td style="text-align: center;">-</td>
        <td style="text-align: center;">-</td>
        <td style="text-align: center;">üî¥ ELIMINADO</td>
        <td style="text-align: left;"><strong>ZOMBIE ELIMINADO.</strong> Archivo legacy borrado del repositorio.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>profile-screen.tsx</code></td>
        <td style="text-align: center;">140</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> Pantalla dividida en vistas especializadas
          (Client/Coach) y l√≥gica extra√≠da.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>useProfileScreenLogic.ts</code></td>
        <td style="text-align: center;">350</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>LIMPIO.</strong> Orquestador de estados para el perfil dual del usuario.
        </td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>client-product-modal.tsx</code></td>
        <td style="text-align: center;">120</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> Descompuesto en Hero, Details, Topics y Comments.
          L√≥gica en hook.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>useClientProductLogic.ts</code></td>
        <td style="text-align: center;">380</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>CENTRALIZADO.</strong> Maneja pagos, l√≠mites de plan y cach√© de talleres.
        </td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>clients-screen.tsx</code></td>
        <td style="text-align: center;">137 (MODULAR)</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üü¢ 9/10</td>
        <td style="text-align: left;"><strong>REFACTOR FINALIZADO.</strong> Monolito segmentado en Hooks y Componentes
          UI. Extremadamente mantenible.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>search-screen.tsx</code></td>
        <td style="text-align: center;">100 (MODULAR)</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> UI dividida en Header, Filters y Results.
          Filtros optimizados y l√≥gica extra√≠da.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>useSearchScreenLogic.ts</code></td>
        <td style="text-align: center;">250</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>CENTRALIZADO.</strong> Maneja b√∫squeda local, stack de navegaci√≥n y load
          de coaches/actividades.
        </td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>ClientDetailModal.tsx</code></td>
        <td style="text-align: center;">766</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> UI segmentada y l√≥gica extra√≠da al hook
          useClientDetailLogic.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>useClientDetailLogic.ts</code></td>
        <td style="text-align: center;">387</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>LIMPIO.</strong> Orquestador de estados para el detalle del cliente.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>onboarding-modal.tsx</code></td>
        <td style="text-align: center;">~70 (MODULAR)</td>
        <td style="text-align: center;">CR√çTICA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 10/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> Monolito de 700 l√≠neas segmentado. L√≥gica extra√≠da
          y UI dividida en sub-componentes.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>useOnboardingLogic.ts</code></td>
        <td style="text-align: center;">~350</td>
        <td style="text-align: center;">CR√çTICA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>CENTRALIZADO.</strong> Maneja wizard de 7 pasos, uploads de avatar y
          m√∫ltiples upserts en DB.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>messages-screen.tsx</code></td>
        <td style="text-align: center;">~80 (MODULAR)</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 10/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> Chat segmentado en componentes de UI (List, Header,
          Input). L√≥gica extra√≠da a hook.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>useMessagesScreenLogic.ts</code></td>
        <td style="text-align: center;">~300</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>CENTRALIZADO.</strong> Orquestador de chats, suscripciones y polling en
          tiempo real.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>activity-calendar.tsx</code></td>
        <td style="text-align: center;">~80 (MODULAR)</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 10/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> L√≥gica de calendario y drag-and-drop extra√≠da a
          hook. UI segmentada (Grid, Header, Dialog).</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>useActivityCalendarLogic.ts</code></td>
        <td style="text-align: center;">~250</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 9/10</td>
        <td style="text-align: left;"><strong>CENTRALIZADO.</strong> Maneja selecci√≥n de fechas, carga de m√©tricas y
          l√≥gica compleja de movimiento de actividades.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>exercise-progress-list.tsx</code></td>
        <td style="text-align: center;">383</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">üîµ 10/10</td>
        <td style="text-align: left;"><strong>ESTABLE.</strong> Recientemente corregido y optimizado para el guardado
          imperativo de cambios.</td>
      </tr>
    </tbody>
  </table>
  <p><strong>Leyenda de Calificaci√≥n:</strong> - üîµ <strong>9-10</strong>: Excelente arquitectura, f√°cil de mantener. -
    üü¢ <strong>7-8</strong>: Estable, pero con margen de optimizaci√≥n en rendimiento. - üü° <strong>5-6</strong>: Deuda
    t√©cnica acumulada. Dif√≠cil de leer/testear. Requiere refactorizaci√≥n. - üî¥ <strong>&lt;5</strong>: C√≥digo peligroso,
    propenso a errores y muy ineficiente.</p>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
  <hr />
  <p><a name="logic-map"></a> ## 16. üå≥ Mapa de Salud Operativa y Estructura (Mission Control)</p>
  <div class="tree-container">
    <div class="tree-title">üõ∞Ô∏è OMNIA MISSION CONTROL: ARQUITECTURA VISUAL</div>

    <span class="tree-division">üì± [APP CLIENTE]</span>
    <div class="tree-branch">
      <span class="tree-tab">üè† HOY / EXPLORAR</span>
      <div class="tree-branch">
        <span class="tree-action">Consumir Rutinas Diarias</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ MODULAR</span>
          <code>TodayScreen (Refactored)</code>
          <span class="line-count">~236 lines</span>
        </div>
      </div>

      <span class="tree-tab">üîç MARKETPLACE</span>
      <div class="tree-branch">
        <span class="tree-action">Buscar Servicios y Coaches</span>
        <div class="tree-detail">
          <span class="status-pill pill-yellow">üü° MEJORABLE</span>
          <code>search-screen.tsx</code>
          <span class="line-count">1189 lines</span>
        </div>
        <span class="tree-action">Detalle de Producto (Modal)</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ MODULAR</span>
          <code>client-product-modal.tsx</code>
          <span class="line-count">120 lines</span>
          <span class="hook-ref">ü™ù useClientProductLogic</span>
        </div>
      </div>

      <span class="tree-tab">üìÖ CALENDARIO</span>
      <div class="tree-branch">
        <span class="tree-action">Vista Mensual y Meets</span>
        <div class="tree-detail">
          <span class="status-pill pill-yellow">üü° MEJORABLE</span>
          <code>CalendarView.tsx</code>
          <span class="line-count">~3700 lines</span>
          <span class="bug-fix">üêõ Fix: Carga de coaches activos</span>
        </div>
        <span class="tree-action">Agendar Sesi√≥n eMeet</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ MODULAR</span>
          <code>activity-calendar.tsx</code>
          <span class="line-count">~80 lines</span>
          <span class="hook-ref">ü™ù useActivityCalendarLogic</span>
        </div>
      </div>

      <span class="tree-tab">üí¨ CHAT</span>
      <div class="tree-branch">
        <span class="tree-action">Comunicaci√≥n Coach-Client</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ MODULAR</span>
          <code>messages-screen.tsx</code>
          <span class="line-count">~80 lines</span>
          <span class="hook-ref">ü™ù useMessagesScreenLogic</span>
        </div>
      </div>

      <span class="tree-tab">üöÄ ONBOARDING</span>
      <div class="tree-branch">
        <span class="tree-action">Perfilado e Inicio</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ MODULAR</span>
          <code>onboarding-modal.tsx</code>
          <span class="line-count">~70 lines</span>
          <span class="hook-ref">ü™ù useOnboardingLogic</span>
        </div>
      </div>

      <span class="tree-tab">üë§ PERFIL</span>
      <div class="tree-branch">
        <span class="tree-action">Gesti√≥n Biom√©trica</span>
        <div class="tree-detail">
          <span class="status-pill pill-green">üü¢ SALUDABLE</span>
          <code>biometrics-modal.tsx</code>
          <span class="line-count">415 lines</span>
        </div>
      </div>
    </div>

    <span class="tree-division">üë®‚Äçüè´ [COACH DASHBOARD]</span>
    <div class="tree-branch">
      <span class="tree-tab">üë• CLIENTES</span>
      <div class="tree-branch">
        <span class="tree-action">Detalle de Cliente (Modular)</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ MODULARIZADO</span>
          <code>ClientDetailModal.tsx</code>
          <span class="line-count">765 lines</span>
        </div>
        <span class="tree-action">L√≥gica de Detalle (Hook)</span>
        <div class="tree-detail">
          <span class="status-pill pill-green">üü¢ SALUDABLE</span>
          <code>useClientDetailLogic.ts</code>
          <span class="line-count">387 lines</span>
        </div>
        <span class="tree-action">Metas de Rendimiento (List)</span>
        <div class="tree-detail">
          <span class="status-pill pill-green">üü¢ SALUDABLE</span>
          <code>exercise-progress-list.tsx</code>
          <span class="line-count">383 lines</span>
        </div>
      </div>

      <span class="tree-tab">üõí PRODUCTOS</span>
      <div class="tree-branch">
        <span class="tree-action">Gesti√≥n del Cat√°logo</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ MODULAR</span>
          <code>ProductsManagement (Index)</code>
          <span class="line-count">89 lines</span>
        </div>
        <span class="tree-action">Wizard de Creaci√≥n (Logic)</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ DOMADO</span>
          <code>useCreateProductLogic.ts</code>
          <span class="line-count">~570 lines</span>
        </div>
        <span class="tree-action">Planificador Diario</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ OPTIMIZADO</span>
          <code>DayExercisesModal.tsx</code>
          <span class="line-count">~430 lines</span>
        </div>
      </div>

      <span class="tree-tab">üì¶ ALMACENAMIENTO</span>
      <div class="tree-branch">
        <span class="tree-action">Gesti√≥n Bunny.net</span>
        <div class="tree-detail">
          <span class="status-pill pill-green">üü¢ SALUDABLE</span>
          <code>StorageUsageWidget</code>
          <span class="line-count">~150 lines</span>
        </div>
      </div>

      <span class="tree-tab">üìä CONTENIDO / CSV</span>
      <div class="tree-branch">
        <span class="tree-action">Carga Masiva de Librer√≠a</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">üîµ DOMADO EXTREMO</span>
          <code>csv-manager-enhanced.tsx</code>
          <span class="line-count">1035 lines</span>
        </div>
      </div>
    </div>
  </div>
  <p><a href="#indice-de-navegacion">Volver al √≠ndice</a></p>
</body>

</html>