<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Biblia Omnia</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }

    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }

    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }

    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }

      p,
      h2,
      h3 {
        orphans: 3;
        widows: 3;
      }

      h2,
      h3,
      h4 {
        page-break-after: avoid;
      }
    }

    p {
      margin: 1em 0;
    }

    a {
      color: #1a1a1a;
    }

    a:visited {
      color: #1a1a1a;
    }

    img {
      max-width: 100%;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin-top: 1.4em;
    }

    h5,
    h6 {
      font-size: 1em;
      font-style: italic;
    }

    h6 {
      font-weight: normal;
    }

    ol,
    ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }

    li>ol,
    li>ul {
      margin-top: 0;
    }

    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }

    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }

    pre {
      margin: 1em 0;
      overflow: auto;
    }

    pre code {
      padding: 0;
      overflow: visible;
    }

    .sourceCode {
      background-color: transparent;
      overflow: visible;
    }

    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }

    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }

    table caption {
      margin-bottom: 0.75em;
    }

    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }

    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }

    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }

    header {
      margin-bottom: 4em;
      text-align: center;
    }

    #TOC li {
      list-style: none;
    }

    #TOC a:not(:hover) {
      text-decoration: none;
    }

    code {
      white-space: pre-wrap;
    }

    span.smallcaps {
      font-variant: small-caps;
    }

    span.underline {
      text-decoration: underline;
    }

    div.column {
      display: inline-block;
      vertical-align: top;
      width: 50%;
    }

    div.hanging-indent {
      margin-left: 1.5em;
      text-indent: -1.5em;
    }

    ul.task-list {
      list-style: none;
    }

    .display.math {
      display: block;
      text-align: center;
      margin: 0.5rem auto;
    }

    /* Visual Logic Map Styles */
    .logic-container {
      background: #0a0b0d;
      color: #e0e0e0;
      padding: 25px;
      border-radius: 16px;
      font-family: 'Menlo', 'Monaco', monospace;
      font-size: 13px;
      margin: 2em 0;
      border: 1px solid #1f2023;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .logic-title {
      color: #FF7939;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }

    .logic-layer {
      margin-bottom: 15px;
      padding-left: 15px;
      border-left: 2px solid #444;
    }

    .layer-label {
      font-size: 10px;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 5px;
      display: block;
    }

    .node {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      margin: 4px 0;
    }

    .ux-node {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid #444;
    }

    .hook-node {
      background: rgba(0, 150, 255, 0.1);
      border: 1px solid #0077ff;
      color: #4faaff;
    }

    .api-node {
      background: rgba(255, 165, 0, 0.1);
      border: 1px solid #ffae00;
      color: #ffae00;
    }

    .state-node {
      background: rgba(76, 175, 80, 0.1);
      border: 1px solid #4caf50;
      color: #81c784;
    }

    .arrow {
      color: #555;
      margin: 0 5px;
    }

    .branch {
      padding-left: 20px;
      border-left: 1px dashed #333;
      margin-top: 5px;
    }

    /* Tree Design Styles */
    .tree-container {
      background: #0d1117;
      color: #c9d1d9;
      padding: 40px;
      border-radius: 12px;
      font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
      font-size: 13px;
      line-height: 2;
      border: 1px solid #30363d;
      margin: 20px 0;
      box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.8);
      position: relative;
    }

    .tree-title {
      color: #58a6ff;
      font-weight: bold;
      font-size: 20px;
      border-bottom: 2px solid #1f6feb;
      margin-bottom: 30px;
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .tree-division {
      color: #ff7b72;
      font-weight: bold;
      font-size: 16px;
      margin-top: 30px;
      display: block;
      padding: 5px 10px;
      background: rgba(255, 123, 114, 0.1);
      border-radius: 4px;
      width: fit-content;
    }

    .tree-branch {
      position: relative;
      margin-left: 20px;
      border-left: 1px solid #30363d;
      padding-left: 20px;
    }

    .tree-tab {
      color: #d2a8ff;
      display: block;
      position: relative;
      font-weight: bold;
    }

    .tree-tab:before {
      content: "";
      position: absolute;
      left: -20px;
      top: 15px;
      width: 15px;
      border-top: 1px solid #30363d;
    }

    .tree-action {
      color: #79c0ff;
      margin-left: 20px;
      display: block;
      position: relative;
    }

    .tree-action:before {
      content: "";
      position: absolute;
      left: -20px;
      top: 15px;
      width: 15px;
      border-top: 1px solid #30363d;
    }

    .tree-detail {
      margin-left: 40px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #8b949e;
      position: relative;
    }

    .tree-detail:before {
      content: "";
      position: absolute;
      left: -20px;
      top: 15px;
      width: 15px;
      border-top: 1px solid #30363d;
    }

    .status-pill {
      font-size: 9px;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .pill-green {
      background: #238636;
      color: #fff;
      box-shadow: 0 0 10px rgba(35, 134, 54, 0.3);
    }

    .pill-yellow {
      background: #9e6a03;
      color: #fff;
      box-shadow: 0 0 10px rgba(158, 106, 3, 0.3);
    }

    .pill-red {
      background: #da3633;
      color: #fff;
      box-shadow: 0 0 10px rgba(218, 54, 51, 0.3);
    }

    .pill-blue {
      background: #1f6feb;
      color: #fff;
      box-shadow: 0 0 10px rgba(31, 111, 235, 0.3);
    }

    .line-count {
      color: #484f58;
      font-size: 11px;
      background: #161b22;
      padding: 0 6px;
      border-radius: 3px;
    }

    code {
      background: none !important;
      color: #c9d1d9 !important;
    }
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>

<body>
  <header id="title-block-header">
    <h1 class="title">Biblia Omnia</h1>
  </header>
  <h1 id="omnia-la-biblia-completa-del-sistema">ğŸ“– OMNIA: La Biblia Completa del Sistema</h1>
  <p>Bienvenido al repositorio central de conocimiento tÃ©cnico de Omnia. Este documento consolida todos los flujos de
    datos, consultas crÃ­ticas y procesos de carga tanto para el Cliente como para el Coach.</p>
  <hr />

  <h2 id="sala-de-trofeos">ğŸ† Sala de Trofeos (Monsters Hunted)</h2>
  <div class="logic-container" style="background: #0f1218; border: 1px solid #30363d;">
    <div class="logic-title" style="color: #e3b341; border-color: #e3b341;">ğŸ’€ MONSTRUOS ABATIDOS</div>

    <div class="logic-layer">
      <span class="layer-label">EL LEVIATÃN (ORIGINAL)</span>
      <div class="node" style="background: #da3633; color: white;">TodayScreen_OLD.tsx (ELIMINADO ğŸ—‘ï¸)</div>
      <div class="branch">
        <span class="arrow">â¬‡ï¸ REFACTORIZADO EN</span>
        <div class="node pill-blue">Modules: Header, ActivityList, Hooks (~236 lÃ­neas core)</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">EL LABERINTO DE PRODUCTOS</span>
      <div class="node" style="background: #da3633; color: white;">products-management-screen_OLD.tsx (ELIMINADO ğŸ—‘ï¸)
      </div>
      <div class="branch">
        <span class="arrow">â¬‡ï¸ DOMADO EN</span>
        <div class="node pill-blue">Index (~89 lÃ­neas) + Logic Hooks (~570 lÃ­neas)</div>
      </div>
    </div>

    <div class="logic-layer">
      <span class="layer-label">EL PLANIFICADOR DEL CAOS</span>
      <div class="node" style="background: #9e6a03; color: white;">DayExercisesModal.tsx (Complejidad LÃ³gica
        Exponencial)</div>
      <div class="branch">
        <span class="arrow">â¬‡ï¸ OPTIMIZADO EN</span>
        <div class="node pill-green">~430 lÃ­neas (Datos Blindados + UI Premium)</div>
      </div>
    </div>
  </div>
  <hr />
  <h2 id="Ã­ndice-de-navegaciÃ³n">ğŸ“‘ Ãndice de NavegaciÃ³n</h2>
  <h3 id="aplicaciÃ³n-del-cliente-client-app">ğŸ‘¤ AplicaciÃ³n del Cliente (Client App)</h3>
  <ol type="1">
    <li><a href="#explorar-marketplace"><strong>Explorar / Marketplace</strong></a>: Descubrimiento y compra de
      productos.</li>
    <li><a href="#mis-actividades"><strong>Mis Actividades</strong></a>: Seguimiento de progreso y consumo.</li>
    <li><a href="#calendario-cliente"><strong>Calendario del Cliente</strong></a>: GestiÃ³n de turnos y eMeets.</li>
    <li><a href="#perfil-cliente"><strong>Perfil del Cliente</strong></a>: Datos personales, biometrÃ­a y metas.</li>
    <li><a href="#comunidad-cliente"><strong>Comunidad</strong></a>: Feed social e interacciones.</li>
    <li><a href="#mensajeria-cliente"><strong>MensajerÃ­a</strong></a>: Chat directo con coaches.</li>
  </ol>
  <h3 id="panel-del-coach-coach-dashboard">ğŸ‘¨â€ğŸ« Panel del Coach (Coach Dashboard)</h3>
  <ol start="7" type="1">
    <li><a href="#gestion-clientes-coach"><strong>GestiÃ³n de Clientes</strong></a>: Cartera y detalle de evoluciÃ³n.</li>
    <li><a href="#gestion-productos-coach"><strong>GestiÃ³n de Productos</strong></a>: CreaciÃ³n de ejercicios y
      nutriciÃ³n.</li>
    <li><a href="#calendario-coach"><strong>Calendario del Coach</strong></a>: Disponibilidad y sincronizaciÃ³n eMeet.
    </li>
    <li><a href="#gestion-video-coach"><strong>GestiÃ³n de Videos (Bunny.net)</strong></a>: Subida y streaming.</li>
    <li><a href="#gestion-documentos-coach"><strong>GestiÃ³n de Documentos</strong></a>: Estructura de PDFs y temas.</li>
    <li><a href="#perfil-coach"><strong>Perfil del Coach</strong></a>: ConfiguraciÃ³n y marca personal.</li>
  </ol>
  <h3 id="lÃ³gica-y-arquitectura-tÃ©cnica">ğŸ§  LÃ³gica y Arquitectura TÃ©cnica</h3>
  <ol start="13" type="1">
    <li><a href="#onboarding-logic"><strong>Formulario de Onboarding</strong></a>: LÃ³gica de admisiÃ³n.</li>
    <li><a href="#progreso-logic"><strong>GeneraciÃ³n de Progreso</strong></a>: El â€œMotor de InstanciaciÃ³nâ€.</li>
    <li><a href="#script-audit"><strong>AuditorÃ­a de Scripts y QA</strong></a>: Dashboard de eficiencia y deuda tÃ©cnica.
    </li>
    <li><a href="#logic-map"><strong>Mapa de Salud Operativa y Estructura</strong></a>: Arquitectura Visual de Omnia.
    </li>
  </ol>
  <p><a name="explorar-marketplace"></a> ## 1. ğŸ” Explorar / Marketplace (Client)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: Descubrimiento y ConversiÃ³n</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Client: Scroll Marketplace â†’ Search "Running" â†’ Click ActivityCard</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">search-screen.tsx: handleSearchChange() â†’ filterActivities()</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node hook-node">handleActivityClick() â†’ setNavigationStack()</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">GET /api/activities/search?q=running</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">View: activities_with_coaches (Pre-mapped)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: isPreviewModalOpen = true â†’ [ClientProductModal]</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> La bÃºsqueda local `filterActivities` es rÃ¡pida pero puede
    desincronizarse si el coach cambia el precio mientras el cliente navega. <em>OptimizaciÃ³n:</em> Implementar
    validaciÃ³n de precio final en el Ãºltimo step del checkout.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="mis-actividades"></a> ## 2. ğŸƒ Mis Actividades (Client)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: Consumo de Producto</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Client: Click en "Actividades" Tab â†’ Selecciona "En curso"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">TodayScreen: useTodayScreenLogic() â†’ filterByStatus("in_progress")</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">RPC: get_user_enrolled_activities(user_id)</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: enrolledActivitiesList â†’ Render ActivityCard con % progreso</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> El cÃ¡lculo de `% progreso` ocurre on-the-fly. <em>OptimizaciÃ³n:</em>
    Persistir el % en `activity_enrollments` cada vez que se marca un item como completado para evitar recalculadas
    costosas.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="calendario-cliente"></a> ## 3. ğŸ“… Calendario del Cliente (Client)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: Agenda de eMeet</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Client: Selecciona fecha â†’ Click en "Agendar Slot"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">activity-calendar.tsx: handleReserveSlot()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">POST /api/calendar/reserve-slot { slotId, userId }</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">DB Table: user_meet_credits (Verifica balance > 0)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: availableSlots â†’ Refetching; credits: -1</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> Race condition en slots populares. <em>OptimizaciÃ³n:</em> Implementar
    bloqueo temporal (Redis/DB lock) de 30s mientras el cliente confirma la compra del slot.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="perfil-cliente"></a> ## 4. ğŸ‘¤ Perfil del Cliente (Client)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: ActualizaciÃ³n BiomÃ©trica</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Client: Abre biometrics-modal â†’ Ingresa "Peso: 85kg" â†’ Save</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">biometrics-modal.tsx: handleSave() â†’ supabase.upsert()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">Table: user_biometrics (New Row with timestamp)</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">DB Table: clients (Update current_weight)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: userStats â†’ re-render Rings de Actividad</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> No hay validaciÃ³n de rangos extremos (ej. peso 1000kg).
    <em>OptimizaciÃ³n:</em> Agregar validaciÃ³n de Z-score para alertar al usuario sobre errores de entrada.
  </p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="comunidad-cliente"></a> ## 5. ğŸ¤ Comunidad (Client)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: Feed Social</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Client: Escribe Post â†’ Click "Publicar"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">community-screen.tsx: handleCreatePost()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">INSERT table: community_posts { user_id, content, media }</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: postsFeed (Unshift new post) â†’ UI: Feed Update</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> InyecciÃ³n de scripts en el content. <em>OptimizaciÃ³n:</em> Sanitizar el
    HTML/Markdown en el cliente y doble check en el DB Trigger.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="mensajeria-cliente"></a> ## 6. ğŸ’¬ MensajerÃ­a (Client)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: Chat Real-Time</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Client: Escribe mensaje â†’ Send</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">messages-screen.tsx: handleSendMessage() â†’ Supabase Subscription</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">INSERT table: messages { chat_id, content }</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">Broadcast: REALTIME payload to recipient</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: activeChatMessages (Push new msg)</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> Flooding de mensajes. <em>OptimizaciÃ³n:</em> Implementar rate-limiting
    por IP/User en la API de mensajerÃ­a (3 msg / sec).</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="gestion-clientes-coach"></a> ## 7. ğŸ‘¥ GestiÃ³n de Clientes (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: AuditorÃ­a de EvoluciÃ³n</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Coach: Click en Cliente "Franco" â†’ Tab "Progreso"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">clients-screen.tsx: loadClientDetailedData()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">View: client_evolution_chart (Aggregation of 30 days)</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: selectedClientStats â†’ Recharts: LineGraph</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> Acceso a clientes de otro coach via URL. <em>OptimizaciÃ³n:</em> RLS
    (Row Level Security) estricto en Supabase verificado: `coach_id = auth.uid()`.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="gestion-productos-coach"></a> ## 8. ğŸ›’ GestiÃ³n de Productos (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: GestiÃ³n de Inventario Comercial</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Coach: Toggle "CafÃ© de Consulta" â†’ Change Price</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">useConsultationLogic.ts: updatePrice() â†’ Optimistic UI Update</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">PATCH /api/coach/consultation { price, enabled }</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">UPDATE table: coaches (Atomic field update)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: consultationData (Synced)</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> Precios negativos o absurdos. <em>OptimizaciÃ³n:</em> Implementar
    validaciÃ³n de Schema (Zod) en el endpoint para asegurar que el precio estÃ© entre $500 y $500.000.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="calendario-coach"></a> ## 9. ğŸ“… Calendario del Coach (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: SincronizaciÃ³n eMeet</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Coach: Abre Calendario â†’ Click "Sincronizar Disponibilidad"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">coach-calendar-screen.tsx: syncWithGoogle()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">API /api/google-calendar/auth â†’ Sync Access Token</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">Worker: Sync external events into activity_sessions</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: agendaItems (Merged Local + Google)</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> ExpiraciÃ³n de tokens de Google. <em>OptimizaciÃ³n:</em> Implementar un
    Refresh Token automÃ¡tico en el worker de sincronizaciÃ³n para evitar que el calendario se quede "congelado".</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="gestion-video-coach"></a> ## 10. ğŸ¥ GestiÃ³n de Videos (Bunny.net) e ImÃ¡genes (Supabase)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: Subida de Media en Wizard de Producto</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Coach: Selecciona Archivo en Wizard</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Decision Branch: Image vs Video</span>
      <div class="branch">
        <span class="arrow">â”œâ”€â”€</span>
        <div class="node hook-node">IMAGEN: Subida Inmediata (Supabase)</div>
        <div class="node api-node">POST /api/upload-organized â†’ Retorna URL pÃºblica</div>
        <span class="arrow">â””â”€â”€</span>
        <div class="node hook-node">VIDEO: Subida Diferida (Bunny.net)</div>
        <div class="node state-node">state: pendingVideoFile (Preview local con URL.createObjectURL)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Final Trigger: Guardar/Publicar Producto</span>
      <div class="node ux-node">Coach: Click "Guardar" o "Publicar"</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">Si hay pendingVideoFile â†’ POST /api/bunny/upload-video (Stream)</div>
        <div class="node api-node">POST /api/products (Guarda URL de imagen ya subida + URL de video reciÃ©n subido)
        </div>
      </div>
    </div>
  </div>
  <p><strong>âš ï¸ Regla de Oro:</strong> Las imÃ¡genes de portada se suben <em>inmediatamente</em> al seleccionarlas para
    feedback visual rÃ¡pido y persistencia simple. Los videos, al ser pesados y costosos (Bunny), se mantienen en memoria
    (Blob local) y <em>solo</em> se suben cuando el usuario confirma la creaciÃ³n/ediciÃ³n del producto.
  </p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="gestion-documentos-coach"></a> ## 11. ğŸ“„ GestiÃ³n de Documentos (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: LibrerÃ­a de Conocimiento</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Coach: Upload PDF â†’ Asigna "Tema: NutriciÃ²n Pro"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">document-manager.tsx: handleDocUpload()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">Supabase Storage: /pdfs/coaches/{id}/*</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">INSERT table: document_topics { pdf_url, activity_id }</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: activityDocs (Ready for client download)</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> PDFs con scripts maliciosos. <em>OptimizaciÃ³n:</em> Implementar escaneo
    de virus en el bucket de Supabase o forzar la visualizaciÃ³n en un Sandboxed PDF Viewer.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="perfil-coach"></a> ## 12. ğŸ‘¤ Perfil del Coach (Coach)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: Marca Personal</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Coach: Edita Bio â†’ Agrega Especialidad "Crossfit" â†’ Save</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">coach-profile-screen.tsx: handleUpdateProfile()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">UPDATE table: user_profiles { bio, specialties }</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: coachMasterProfile (Synced) â†’ UI: "Perfil actualizado"</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> SuplantaciÃ³n de identidad si se permite cambiar correos verificados.
    <em>OptimizaciÃ³n:</em> Bloquear el cambio de Email una vez la cuenta es de tipo "Coach" y requerir ticket de soporte
    para modificaciones legales.
  </p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="onboarding-logic"></a> ## 13. ğŸ§  Formulario de Onboarding (LÃ³gica)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: Perfilado del Cliente</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">Client: Completa Step 7 â†’ Click "Listo, Empezar"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Hooks</span>
      <div class="node hook-node">onboarding-modal.tsx: handleSubmit()</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">UPSERT: client_onboarding_responses (Answers mapping)</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">UPDATE: clients (Fisical data parsing)</div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: userOnboarded = true â†’ (Close Modal)</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> DesconexiÃ³n durante el envÃ­o de 7 pasos. <em>OptimizaciÃ³n:</em>
    Implementar guardado parcial ("Draft") en cada step para que el usuario pueda retomar si se queda sin baterÃ­a o
    seÃ±al.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="progreso-logic"></a> ## 14. âš™ï¸ GeneraciÃ³n de Progreso (Technical)</p>
  <div class="logic-container">
    <div class="logic-title">ğŸŒ€ Workflow: El Motor de InstanciaciÃ³n</div>
    <div class="logic-layer">
      <span class="layer-label">UX â†’ Trigger</span>
      <div class="node ux-node">System: Detection of "Purchase Completed"</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Frontend Logic â†’ Trigger</span>
      <div class="node hook-node">client-product-modal.tsx: handlePurchase() â†’ activation_trigger</div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Backend Logic â†’ API/DB</span>
      <div class="node api-node">API /api/initialize-progress (The Oracle)</div>
      <div class="branch">
        <span class="arrow">â””â”€â”€</span>
        <div class="node api-node">Fetch definition (planificacion_ejercicios)</div>
        <div class="branch">
          <span class="arrow">â””â”€â”€</span>
          <div class="node api-node">Apply Onboarding Filters (Conditionals: injuries/level)</div>
          <span class="arrow">â””â”€â”€</span>
          <div class="node api-node">INSERT: progreso_cliente (The massive persistent list)</div>
        </div>
      </div>
    </div>
    <div class="logic-layer">
      <span class="layer-label">Data State â†’ UI</span>
      <div class="node state-node">state: progression_initialized = true</div>
    </div>
  </div>
  <p><strong>âš ï¸ Scan de Vulnerabilidad:</strong> Tiempo de ejecuciÃ³n excesivo en programas de +6 meses.
    <em>OptimizaciÃ³n:</em> Ejecutar el motor en un **Background Queue** y notificar al cliente vÃ­a Push/Email cuando su
    plan estÃ© listo.
  </p>
  <hr />
  <p><a name="script-audit"></a> ## 15. ğŸ§ª AuditorÃ­a de Scripts y Eficiencia (QA Dashboard) AnÃ¡lisis de los archivos
    crÃ­ticos del sistema para evaluaciÃ³n de rendimiento, deuda tÃ©cnica y estabilidad.</p>
  <table>
    <colgroup>
      <col style="width: 14%" />
      <col style="width: 17%" />
      <col style="width: 17%" />
      <col style="width: 17%" />
      <col style="width: 17%" />
      <col style="width: 14%" />
    </colgroup>
    <thead>
      <tr class="header">
        <th style="text-align: left;">Script / Componente</th>
        <th style="text-align: center;">LÃ­neas</th>
        <th style="text-align: center;">Importancia</th>
        <th style="text-align: center;">Redundancia</th>
        <th style="text-align: center;">CalificaciÃ³n QA</th>
        <th style="text-align: left;">Observaciones del QA Tester</th>
      </tr>
    </thead>
    <tbody>
      <tr class="odd">
        <td style="text-align: left;"><code>ProductsManagement (Refactored)</code></td>
        <td style="text-align: center;">~1000</td>
        <td style="text-align: center;">CRÃTICA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">ğŸ”µ 10/10</td>
        <td style="text-align: left;"><strong>MODULARIZADO.</strong> LÃ³gica separada de la UI. Altamente mantenible y
          performante en mobile.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>useCreateProductLogic.ts (Refactored)</code></td>
        <td style="text-align: center;">~570</td>
        <td style="text-align: center;">CRÃTICA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">ğŸ”µ 9/10</td>
        <td style="text-align: left;"><strong>DOMADO.</strong> LÃ³gica de Wizard extraÃ­da y modularizada en 6 sub-hooks
          especializados.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>csv-manager-enhanced.tsx</code></td>
        <td style="text-align: center;">1035</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">ğŸ”µ 10/10</td>
        <td style="text-align: left;"><strong>DOMADO EXTREMO.</strong> LÃ³gica totalmente extraÃ­da a hooks especializados
          (useCsvActions, useCsvFileProcessor). UI limpia y modular.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>weekly-exercise-planner.tsx</code></td>
        <td style="text-align: center;">326</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">ğŸ”µ 9/10</td>
        <td style="text-align: left;">FÃ‰NIX. Refactorizado masivamente. La lÃ³gica compleja migrÃ³ a
          DayExercisesModal.tsx.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>CalendarView.tsx</code></td>
        <td style="text-align: center;">3727</td>
        <td style="text-align: center;">CRÃTICA</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">ğŸŸ¢ 8/10</td>
        <td style="text-align: left;">Estable. Recientemente se ajustÃ³ la visualizaciÃ³n de celdas y modales de temas.
        </td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>coach-calendar-screen.tsx</code></td>
        <td style="text-align: center;">3141</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">ğŸŸ¢ 7/10</td>
        <td style="text-align: left;">Manejo de estados de eMeet funcional pero complejo.</td>
      </tr>

      <tr class="even">
        <td style="text-align: left;"><s>products-management-screen_OLD.tsx</s></td>
        <td style="text-align: center;">0</td>
        <td style="text-align: center;">-</td>
        <td style="text-align: center;">-</td>
        <td style="text-align: center;">ğŸ”´ ELIMINADO</td>
        <td style="text-align: left;"><strong>ZOMBIE ELIMINADO.</strong> Archivo legacy borrado del repositorio.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>profile-screen.tsx</code></td>
        <td style="text-align: center;">1947</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">ğŸŸ¡ 5/10</td>
        <td style="text-align: left;">Componente Mobile grande. Candidato a modularizaciÃ³n en sub-componentes.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>client-product-modal.tsx</code></td>
        <td style="text-align: center;">1932</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">MEDIA</td>
        <td style="text-align: center;">ğŸŸ¡ 6/10</td>
        <td style="text-align: left;">LÃ³gica de compra y visualizaciÃ³n de producto cliente. Complejidad creciente.</td>
      </tr>
      <tr class="odd">
        <td style="text-align: left;"><code>clients-screen.tsx</code></td>
        <td style="text-align: center;">137 (MODULAR)</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">ğŸŸ¢ 9/10</td>
        <td style="text-align: left;"><strong>REFACTOR FINALIZADO.</strong> Monolito segmentado en Hooks y Componentes
          UI. Extremadamente mantenible.</td>
      </tr>
      <tr class="even">
        <td style="text-align: left;"><code>search-screen.tsx</code></td>
        <td style="text-align: center;">1189</td>
        <td style="text-align: center;">ALTA</td>
        <td style="text-align: center;">BAJA</td>
        <td style="text-align: center;">ğŸŸ¡ 6/10</td>
        <td style="text-align: left;">BÃºsqueda y filtros. La lÃ³gica de local-filtering deberÃ­a ir a un useMemo hook
          externo.</td>
      </tr>
    </tbody>
  </table>
  <p><strong>Leyenda de CalificaciÃ³n:</strong> - ğŸ”µ <strong>9-10</strong>: Excelente arquitectura, fÃ¡cil de mantener. -
    ğŸŸ¢ <strong>7-8</strong>: Estable, pero con margen de optimizaciÃ³n en rendimiento. - ğŸŸ¡ <strong>5-6</strong>: Deuda
    tÃ©cnica acumulada. DifÃ­cil de leer/testear. Requiere refactorizaciÃ³n. - ğŸ”´ <strong>&lt;5</strong>: CÃ³digo peligroso,
    propenso a errores y muy ineficiente.</p>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
  <hr />
  <p><a name="logic-map"></a> ## 16. ğŸŒ³ Mapa de Salud Operativa y Estructura (Mission Control)</p>
  <div class="tree-container">
    <div class="tree-title">ğŸ›°ï¸ OMNIA MISSION CONTROL: ARQUITECTURA VISUAL</div>

    <span class="tree-division">ğŸ“± [APP CLIENTE]</span>
    <div class="tree-branch">
      <span class="tree-tab">ğŸ  HOY / EXPLORAR</span>
      <div class="tree-branch">
        <span class="tree-action">Consumir Rutinas Diarias</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">ğŸ”µ MODULAR</span>
          <code>TodayScreen (Refactored)</code>
          <span class="line-count">~236 lines</span>
        </div>
      </div>

      <span class="tree-tab">ğŸ” MARKETPLACE</span>
      <div class="tree-branch">
        <span class="tree-action">Buscar Servicios y Coaches</span>
        <div class="tree-detail">
          <span class="status-pill pill-yellow">ğŸŸ¡ MEJORABLE</span>
          <code>search-screen.tsx</code>
          <span class="line-count">1189 lines</span>
        </div>
      </div>

      <span class="tree-tab">ğŸ“… CALENDARIO</span>
      <div class="tree-branch">
        <span class="tree-action">Agendar SesiÃ³n eMeet</span>
        <div class="tree-detail">
          <span class="status-pill pill-yellow">ğŸŸ¡ MEJORABLE</span>
          <code>activity-calendar.tsx</code>
          <span class="line-count">501 lines</span>
        </div>
      </div>

      <span class="tree-tab">ğŸ‘¤ PERFIL</span>
      <div class="tree-branch">
        <span class="tree-action">GestiÃ³n BiomÃ©trica</span>
        <div class="tree-detail">
          <span class="status-pill pill-green">ğŸŸ¢ SALUDABLE</span>
          <code>biometrics-modal.tsx</code>
          <span class="line-count">415 lines</span>
        </div>
      </div>
    </div>

    <span class="tree-division">ğŸ‘¨â€ğŸ« [COACH DASHBOARD]</span>
    <div class="tree-branch">
      <span class="tree-tab">ğŸ‘¥ CLIENTES</span>
      <div class="tree-branch">
        <span class="tree-action">Detalle de Cliente (Modular)</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">ğŸ”µ MODULARIZADO</span>
          <code>ClientDetailModal.tsx</code>
          <span class="line-count">765 lines</span>
        </div>
        <span class="tree-action">LÃ³gica de Detalle (Hook)</span>
        <div class="tree-detail">
          <span class="status-pill pill-green">ğŸŸ¢ SALUDABLE</span>
          <code>useClientDetailLogic.ts</code>
          <span class="line-count">387 lines</span>
        </div>
        <span class="tree-action">Metas de Rendimiento (List)</span>
        <div class="tree-detail">
          <span class="status-pill pill-green">ğŸŸ¢ SALUDABLE</span>
          <code>exercise-progress-list.tsx</code>
          <span class="line-count">383 lines</span>
        </div>
      </div>

      <span class="tree-tab">ğŸ›’ PRODUCTOS</span>
      <div class="tree-branch">
        <span class="tree-action">GestiÃ³n del CatÃ¡logo</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">ğŸ”µ MODULAR</span>
          <code>ProductsManagement (Index)</code>
          <span class="line-count">89 lines</span>
        </div>
        <span class="tree-action">Wizard de CreaciÃ³n (Logic)</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">ğŸ”µ DOMADO</span>
          <code>useCreateProductLogic.ts</code>
          <span class="line-count">~570 lines</span>
        </div>
        <span class="tree-action">Planificador Diario</span>
        <div class="tree-detail">
          <span class="status-pill pill-blue">ğŸ”µ OPTIMIZADO</span>
          <code>DayExercisesModal.tsx</code>
          <span class="line-count">~430 lines</span>
        </div>
      </div>

      <span class="tree-tab">ğŸ“¦ ALMACENAMIENTO</span>
      <div class="tree-branch">
        <span class="tree-action">GestiÃ³n Bunny.net</span>
        <div class="tree-detail">
          <span class="status-pill pill-green">ğŸŸ¢ SALUDABLE</span>
          <code>StorageUsageWidget</code>
          <span class="line-count">~150 lines</span>
        </div>
      </div>

      <span class="tree-tab">ğŸ“Š CONTENIDO / CSV</span>
      <div class="tree-branch">
        <span class="tree-action">Carga Masiva de LibrerÃ­a</span>
        <div class="tree-detail">
          <span class="status-pill pill-yellow">ğŸŸ¡ EN PROGRESO</span>
          <code>csv-manager-enhanced.tsx</code>
          <span class="line-count">1035 lines</span>
        </div>
      </div>
    </div>
  </div>
  <p><a href="#indice-de-navegacion">Volver al Ã­ndice</a></p>
</body>

</html>